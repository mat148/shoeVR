<!doctype html>
<html lang="en">
<head>
    <title>Template (Three.js)</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
</head>
<body>

<script src="js/three.min.js"></script>
<script src="js/main.js"></script>
<script src="js/Detector.js"></script>
<script src="js/Stats.js"></script>
<script src="js/OrbitControls.js"></script>
<!--<script src="js/KeyboardState.js"></script>-->
  
<script src="js/BinaryLoader.js"></script>
<script src="js/WebGLDeferredRenderer.js"></script>
<script src="js/ShaderDeferred.js"></script>

<script src="js/CopyShader.js"></script>
<script src="js/FXAAShader.js"></script>

<script src="js/EffectComposer.js"></script>
<script src="js/RenderPass.js"></script>
<script src="js/ShaderPass.js"></script>
<script src="js/MaskPass.js"></script>
  
<script src="js/THREEx.FullScreen.js"></script>
<script src="js/THREEx.WindowResize.js"></script>
<script src="js/DeviceOrientationControls.js"></script>

<!-- Code to display an information button and box when clicked. -->
<script src="js/jquery-1.11.2.min.js"></script>
<!--<script src="js/jquery-ui.js"></script>-->
<!--<link rel=stylesheet href="css/jquery-ui.css" />
<link rel=stylesheet href="css/info.css"/>-->

<div id="ThreeJS" style="position: absolute; left:0px; top:0px"></div>
<script>
/*
	Three.js "tutorials by example"
	Author: Lee Stemkoski
	Date: July 2013 (three.js v59dev)
 */

// MAIN

// standard global variables
var container, scene, camera, renderer, controls, stats;
//var keyboard = new KeyboardState();
var clock = new THREE.Clock();
  
var SHADOW_MAP_WIDTH = 2048, SHADOW_MAP_HEIGHT = 1024;

// custom global variables
var mesh;

init();
animate();

// FUNCTIONS 		
function init() 
{
	// SCENE
	scene = new THREE.Scene();
  
	// CAMERA
	var SCREEN_WIDTH = window.innerWidth, SCREEN_HEIGHT = window.innerHeight;
	var VIEW_ANGLE = 45, ASPECT = SCREEN_WIDTH / SCREEN_HEIGHT, NEAR = 0.1, FAR = 20000;
    camera = new THREE.PerspectiveCamera( VIEW_ANGLE, ASPECT, NEAR, FAR);
    controls = new THREE.DeviceOrientationControls( camera );
	scene.add(camera);
	camera.position.set(0,150,0);
  
	//scene.fog = new THREE.Fog(0x6a3e6d, 300, 1000);
  
	//camera.rotation.x = -90;
	// RENDERER
	if ( Detector.webgl ){
		renderer = new THREE.WebGLRenderer( {antialias:true} );
        //renderer = new THREE.WebGLDeferredRenderer( { antialias: true } );
        renderer.setSize(SCREEN_WIDTH, SCREEN_HEIGHT);
        renderer.shadowMapEnabled = true;
        renderer.shadowMapType = THREE.PCFSoftShadowMap;
    }
	else{
      renderer = new THREE.CanvasRenderer(); 
      renderer.setSize(SCREEN_WIDTH, SCREEN_HEIGHT);
      renderer.shadowMapEnabled = true;
      renderer.shadowMapType = THREE.PCFSoftShadowMap;
      renderer.shadowMapSoft = true;
    }
  
	container = document.getElementById( 'ThreeJS' );
	container.appendChild( renderer.domElement );
	// EVENTS
	THREEx.WindowResize(renderer, camera);
	THREEx.FullScreen.bindKey({ charCode : 'm'.charCodeAt(0) });
  
	// CONTROLS
	controls = new THREE.OrbitControls( camera, renderer.domElement );
  
	// STATS
	stats = new Stats();
	stats.domElement.style.position = 'absolute';
	stats.domElement.style.bottom = '0px';
	stats.domElement.style.zIndex = 100;
	container.appendChild( stats.domElement );
    
    //pillar floor texture
    var pillarFloorTexture = new THREE.MeshPhongMaterial({
        map: THREE.ImageUtils.loadTexture('img/FloorTexture.png'),
        side: THREE.DoubleSide,
        transparent: true,
        color: 0xffffff,
        emissive: 0xc3bde5,
      });
  
    var pillarFloor = new THREE.Mesh(new THREE.PlaneGeometry(500, 500, 10, 10), pillarFloorTexture);
    pillarFloor.overdraw = true;
	pillarFloor.position.y = 0;
	pillarFloor.rotation.x = Math.PI / 2;
    pillarFloor.receiveShadow = true;
	scene.add(pillarFloor);
  
    //infinite floor texture
    var infiniteFloorTexture = new THREE.MeshPhongMaterial({
		//opacity: 0.75,
		//transparent: true,
        color: 0x083650,
        //ambient: 0xffffff,
        //specular: 0xffffff,
        //emissive: 0x083650,
        side: THREE.BackSide,
        shininess: 50,
      });
  
    //var material = new THREE.MeshPhongMaterial( { color: 0xffaa55, specular: 0x888888, shininess: 200 } );
  
    var infiniteFloor = new THREE.Mesh(new THREE.PlaneGeometry(10000, 10000, 10, 10), infiniteFloorTexture);
    //infiniteFloor.overdraw = true;
	infiniteFloor.position.y = -2;
	infiniteFloor.rotation.x = Math.PI / 2;
    //infiniteFloor.castShadow = false;
    infiniteFloor.receiveShadow = true;
	scene.add(infiniteFloor);
    
	// skybox
	var geometry = new THREE.SphereGeometry(10000, 64, 32);

	var vertices = geometry.vertices;
	var faces = geometry.faces;

	var colorTop = new THREE.Color(0xdc72aa);
	var colorMiddle = new THREE.Color(0xfbdfd3);
	var colorBottom = new THREE.Color(0xdc72aa);

	for (var i = 0, l = faces.length; i < l; i++) {
		var face = faces[i];

		var vertex1 = vertices[face.a];
		var vertex2 = vertices[face.b];
		var vertex3 = vertices[face.c];

		var color1 = colorMiddle.clone();
		color1.lerp(vertex1.y > 0 ? colorTop : colorBottom, Math.abs(vertex1.y) / 6000);

		var color2 = colorMiddle.clone();
		color2.lerp(vertex2.y > 0 ? colorTop : colorBottom, Math.abs(vertex2.y) / 6000);

		var color3 = colorMiddle.clone();
		color3.lerp(vertex3.y > 0 ? colorTop : colorBottom, Math.abs(vertex3.y) / 6000);

		face.vertexColors.push(color1, color2, color3);

	}

	var material = new THREE.MeshBasicMaterial({
		vertexColors: THREE.VertexColors,
		side: THREE.BackSide,
		depthWrite: false,
		//depthTest: false,
		fog: false,
	});

	sky = new THREE.Mesh(geometry, material);
	scene.add(sky);
	
	////////////
	// CUSTOM //
	////////////
  
    var pillarMaterial = new THREE.MeshPhongMaterial({
      color: 0xeaeaea,
      ambient: 0x062537,
      emissive: 0x919191,
      specular: 0x6a3e6d,
      shading: THREE.FlatShading,
      fog: false,
      shininess: 50,
    });
    
    // cylinder
    var pillar = new THREE.CylinderGeometry(30,30,80,20,4);
    //var pillarMaterial = new THREE.MeshLambertMaterial( { color: 0xeaeaea } );
    
    firePillar = new THREE.Mesh(pillar, pillarMaterial);
    firePillar.position.set(215,0,0);
    firePillar.castShadow = true;
    firePillar.receiveShadow = true;
    scene.add(firePillar);
    
    waterPillar = new THREE.Mesh(pillar, pillarMaterial);
    waterPillar.position.set(-215,0,0);
    waterPillar.castShadow = true;
    waterPillar.receiveShadow = true;
    scene.add(waterPillar);
    
    earthPillar = new THREE.Mesh(pillar, pillarMaterial);
    earthPillar.position.set(0,0,215);
    earthPillar.castShadow = true;
    earthPillar.receiveShadow = true;
    scene.add(earthPillar);
    
    airPillar = new THREE.Mesh(pillar, pillarMaterial);
    airPillar.position.set(0,0,-215);
    airPillar.castShadow = true;
    airPillar.receiveShadow = true;
    scene.add(airPillar);
  
    //IMPORT OBJECTS
  
    
  
  
    // LIGHT
    
    var directionalLight = new THREE.DirectionalLight(0xffffff, 1);
	directionalLight.position.set(500, 1000, 0);
    directionalLight.castShadow = true;
    directionalLight.shadowBias = -0.0018;
    directionalLight.shadowCameraVisible = true;
    directionalLight.shadowMapWidth = 2042;
    directionalLight.shadowMapHeight = 2042;
	scene.add(directionalLight);
  
    /*var pointLight = new THREE.PointLight(0xff0d0d, 5, 5000);
    pointLight.position.set(0, 10, 0);
    scene.add(pointLight);*/

	/*var hemisphereLight = new THREE.HemisphereLight(0x6a3e6d, 0x007c9a , 0.1);
	hemisphereLight.position.set(-1, 2, 1.5);
	scene.add(hemisphereLight);*/
  
    /*var spotLight = new THREE.SpotLight(0xffffff, 4.5, 0);
    //spotLight.target.position.set(-7.88, 0, -261.10);
    spotLight.castShadow = true;
    spotLight.shadowCameraNear = 1200;
    spotLight.shadowCameraFar = 2500;
    spotLight.shadowCameraFov = 50;

    spotLight.shadowBias = 0.0001;
    spotLight.shadowDarkness = 0.5;

    spotLight.shadowMapWidth = SHADOW_MAP_WIDTH;
    spotLight.shadowMapHeight = SHADOW_MAP_HEIGHT;
    spotLight.position.set(0, 213.83, 0);
    scene.add(spotLight);*/
    
    // add spotlight for the shadows
        /*var spotLight = new THREE.SpotLight(0xffffff);
        spotLight.position.set(-40, 120, -10);
        spotLight.castShadow = true;
        scene.add(spotLight);*/
  
    //var ambientLight = new THREE.AmbientLight(0xffffff);
    //ambientLight.color.setRGB( 255 * 0.005, 255 * 0.005, 255 * 0.005);
    //scene.add(ambientLight);
}

function animate() 
{
    requestAnimationFrame( animate );
	render();		
	update();
    controls.update();
 
}

function update()
{
	/*if ( keyboard.pressed("z") ) 
	{	  
		// do something
	}*/
	
	//controls.update();
    //camera.lookAt(firePillar.position);
	stats.update();
}

function render() 
{
	renderer.render( scene, camera );
  
//    cubeCamera.updateCubeMap( renderer, scene );
    firePillar.visible = true;
    waterPillar.visible = true;
    earthPillar.visible = true;
    airPillar.visible = true;
 
}

</script>
    
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-60488291-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>
